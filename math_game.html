<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>数学小天才 - 二年级下册</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Ma+Shan+Zheng&family=ZCOOL+KuaiLe&display=swap');
        
        body {
            font-family: 'Ma Shan Zheng', cursive;
            background-color: #E6F3FF;
            color: #2C3E50;
        }
        
        .game-container {
            background: url('https://img.freepik.com/free-vector/hand-painted-watercolor-pastel-sky-background_23-2148902771.jpg') no-repeat center center;
            background-size: cover;
            border-radius: 20px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }
        
        .question-box {
            background-color: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            border: 3px solid #3498DB;
        }
        
        .option {
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .option:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .correct {
            background-color: #2ECC71 !important;
            color: white !important;
            animation: bounce 0.5s;
        }
        
        .wrong {
            background-color: #E74C3C !important;
            color: white !important;
            animation: shake 0.5s;
        }
        
        .title {
            font-family: 'ZCOOL KuaiLe', cursive;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
        }
        
        .progress-bar {
            height: 10px;
            border-radius: 5px;
            background-color: #E0E0E0;
        }
        
        .progress-fill {
            height: 100%;
            border-radius: 5px;
            background: linear-gradient(90deg, #3498DB, #2ECC71);
            transition: width 0.5s ease;
        }
        
        .celebration {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 100;
            animation: fadeIn 0.5s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            background-color: #f00;
            animation: fall 5s linear infinite;
        }
        
        @keyframes fall {
            to {
                transform: translateY(100vh);
            }
        }
        
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            20%, 60% { transform: translateX(-5px); }
            40%, 80% { transform: translateX(5px); }
        }
        
        .avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border: 3px solid white;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
        }
        
        .avatar:hover {
            transform: scale(1.1);
        }
        
        .badge {
            display: inline-block;
            padding: 2px 6px;
            border-radius: 10px;
            font-size: 12px;
            margin-left: 5px;
            background-color: #3498DB;
            color: white;
        }
        
        .streak {
            position: relative;
            display: inline-flex;
            align-items: center;
            margin-left: 10px;
        }
        
        .streak-fire {
            color: #E74C3C;
            margin-right: 3px;
            animation: flame 1s infinite alternate;
        }
        
        @keyframes flame {
            from { transform: scale(1); }
            to { transform: scale(1.2); }
        }
        
        .powerup {
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        
        .level-up {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: rgba(255, 255, 255, 0.9);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            z-index: 200;
            text-align: center;
            animation: zoomIn 0.5s;
        }
        
        @keyframes zoomIn {
            from { transform: translate(-50%, -50%) scale(0.5); opacity: 0; }
            to { transform: translate(-50%, -50%) scale(1); opacity: 1; }
        }
        
        .daily-reward {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 300;
        }
        
        .reward-box {
            background-color: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            max-width: 300px;
        }
        
        .reward-calendar {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
            margin: 15px 0;
        }
        
        .reward-day {
            padding: 5px;
            border-radius: 5px;
            background-color: #f0f0f0;
        }
        
        .reward-day.active {
            background-color: #3498DB;
            color: white;
        }
        
        .reward-day.today {
            border: 2px solid #2ECC71;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center justify-center p-4">
    <div class="game-container w-full max-w-md p-6 relative overflow-hidden">
        <!-- 顶部信息栏 -->
        <div class="flex justify-between items-center mb-6">
            <div class="flex items-center">
                <img id="avatar" src="https://img.icons8.com/color/96/000000/math.png" class="avatar mr-2" alt="数学小天才">
                <div>
                    <h1 class="title text-xl font-bold text-blue-600">数学小天才</h1>
                    <div class="flex items-center">
                        <span id="level" class="text-sm">等级: 1</span>
                        <span id="xp" class="text-sm ml-2">经验: 0/100</span>
                    </div>
                </div>
            </div>
            <div class="flex items-center">
                <div class="streak" id="streak-container" style="display: none;">
                    <i class="fas fa-fire streak-fire"></i>
                    <span id="streak-count">0</span>
                </div>
                <div class="ml-4 flex items-center">
                    <i class="fas fa-coins text-yellow-500 mr-1"></i>
                    <span id="coins" class="font-bold">100</span>
                </div>
            </div>
        </div>
        
        <!-- 进度条 -->
        <div class="progress-bar w-full mb-6">
            <div id="progress-fill" class="progress-fill" style="width: 0%"></div>
        </div>
        
        <!-- 问题区域 -->
        <div id="question-container" class="question-box p-6 mb-6">
            <div class="flex justify-between items-center mb-4">
                <span id="question-number" class="text-sm font-bold">问题 1/10</span>
                <span id="timer" class="text-sm font-bold">⏱️ 30秒</span>
            </div>
            <h2 id="question" class="text-xl font-bold mb-4 text-center">加载中...</h2>
            <div id="options" class="grid grid-cols-2 gap-4">
                <!-- 选项将通过JavaScript动态生成 -->
            </div>
            <div class="flex justify-between items-center mt-4">
                <button id="hint-btn" class="bg-blue-100 text-blue-800 px-4 py-2 rounded-full flex items-center">
                    <i class="fas fa-lightbulb mr-2"></i> 提示
                </button>
                <button id="skip-btn" class="bg-yellow-100 text-yellow-800 px-4 py-2 rounded-full flex items-center">
                    <i class="fas fa-forward mr-2"></i> 跳过
                </button>
            </div>
            <div id="hint-text" class="hidden mt-2 text-sm text-gray-600"></div>
        </div>
        
        <!-- 能量道具 -->
        <div class="flex justify-around mb-4">
            <button id="double-xp" class="powerup bg-green-100 text-green-800 px-3 py-1 rounded-full flex items-center text-sm" title="双倍经验(30秒)">
                <i class="fas fa-bolt mr-1"></i> 双倍经验
                <span id="double-xp-count" class="badge">1</span>
            </button>
            <button id="freeze-timer" class="powerup bg-blue-100 text-blue-800 px-3 py-1 rounded-full flex items-center text-sm" title="冻结时间(10秒)">
                <i class="fas fa-snowflake mr-1"></i> 冻结时间
                <span id="freeze-timer-count" class="badge">1</span>
            </button>
            <button id="remove-wrong" class="powerup bg-red-100 text-red-800 px-3 py-1 rounded-full flex items-center text-sm" title="移除错误答案">
                <i class="fas fa-eraser mr-1"></i> 移除错误
                <span id="remove-wrong-count" class="badge">1</span>
            </button>
        </div>
        
        <!-- 底部导航 -->
        <div class="flex justify-around bg-blue-100 bg-opacity-50 rounded-lg p-2">
            <span>数学小天才，加油！！！</span>
        </div>
        
        <!-- 装饰元素 -->
        <div class="absolute -top-4 -right-4 w-24 h-24 bg-blue-200 rounded-full opacity-20"></div>
        <div class="absolute -bottom-4 -left-4 w-32 h-32 bg-green-200 rounded-full opacity-20"></div>
    </div>
    
    <!-- 提示模态框 -->
    <div id="hint-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white p-6 rounded-lg max-w-sm w-full mx-4">
            <h3 class="text-xl font-bold mb-4 text-blue-600">提示</h3>
            <p id="hint-text" class="mb-4">提示内容加载中...</p>
            <div class="flex justify-end">
                <button id="close-hint" class="bg-blue-600 text-white px-4 py-2 rounded">知道了</button>
            </div>
        </div>
    </div>
    
    <!-- 结果模态框 -->
    <div id="result-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white p-6 rounded-lg max-w-sm w-full mx-4 text-center">
            <i id="result-icon" class="fas fa-check-circle text-5xl mb-4 text-green-500"></i>
            <h3 id="result-title" class="text-xl font-bold mb-2">回答正确!</h3>
            <div class="flex justify-center items-center mb-2">
                <span class="mr-2">获得:</span>
                <i class="fas fa-coins text-yellow-500 mr-1"></i>
                <span id="coins-earned" class="font-bold mr-3">20</span>
                <i class="fas fa-star text-yellow-400 mr-1"></i>
                <span id="xp-earned" class="font-bold">10</span>
            </div>
            <p id="result-text" class="mb-4">你太棒了!</p>
            <button id="next-question" class="bg-blue-600 text-white px-6 py-2 rounded-full">下一题</button>
        </div>
    </div>
    
    <!-- 庆祝动画容器 -->
    <div id="celebration-container" class="celebration hidden"></div>
    
    <!-- 升级提示 -->
    <div id="level-up" class="level-up hidden">
        <i class="fas fa-trophy text-5xl text-yellow-500 mb-2"></i>
        <h3 class="text-xl font-bold mb-1">升级啦!</h3>
        <p id="new-level" class="mb-2">你现在是等级 2!</p>
        <p class="text-sm text-gray-600">获得新头像和奖励!</p>
        <button id="close-level-up" class="bg-blue-600 text-white px-4 py-1 rounded-full mt-2">继续</button>
    </div>
    
    <!-- 每日奖励 -->
    <div id="daily-reward" class="daily-reward hidden">
        <div class="reward-box">
            <h3 class="text-xl font-bold mb-2">每日奖励</h3>
            <p class="mb-2">连续登录可获得更多奖励!</p>
            
            <div class="reward-calendar">
                <div class="reward-day">日</div>
                <div class="reward-day">一</div>
                <div class="reward-day">二</div>
                <div class="reward-day">三</div>
                <div class="reward-day">四</div>
                <div class="reward-day">五</div>
                <div class="reward-day">六</div>
                
                <div class="reward-day">10</div>
                <div class="reward-day active">20</div>
                <div class="reward-day active">30</div>
                <div class="reward-day active">50</div>
                <div class="reward-day today">100</div>
                <div class="reward-day">150</div>
                <div class="reward-day">200</div>
            </div>
            
            <p class="my-3">今日奖励: <span class="font-bold text-yellow-500">100 金币</span></p>
            <button id="claim-reward" class="bg-blue-600 text-white px-6 py-2 rounded-full">领取奖励</button>
        </div>
    </div>
    
    <script>
        // 二年级下册数学题目
        const questions = [
            {
                question: "25 + 37 = ?",
                options: [
                    "62",
                    "52",
                    "72",
                    "42"
                ],
                correct: 0,
                hint: "先计算个位：5+7=12，写2进1；再计算十位：2+3+1=6，所以答案是62。"
            },
            {
                question: "判断：100厘米 = 1米",
                options: [
                    "正确",
                    "错误"
                ],
                correct: 0,
                hint: "1米等于100厘米，这是长度单位换算的基本关系。"
            },
            {
                question: "小明有12个苹果，他给了小红3个，又给了小华2个，还剩几个？",
                options: [
                    "5个",
                    "6个",
                    "7个",
                    "8个"
                ],
                correct: 2,
                hint: "12-3-2=7，所以小明还剩7个苹果。"
            },
            {
                question: "下列哪个图形是正方形？",
                options: [
                    "四条边相等，四个角都是直角的四边形",
                    "三条边相等的三角形",
                    "两条边相等的四边形",
                    "四个角都是直角的四边形"
                ],
                correct: 0,
                hint: "正方形的特点是四条边相等，四个角都是直角。"
            },
            {
                question: "8 × 7 = ?",
                options: [
                    "54",
                    "56",
                    "58",
                    "60"
                ],
                correct: 1,
                hint: "8×7=56，可以用8+8+8+8+8+8+8=56来帮助记忆。"
            },
            {
                question: "判断：1千克 = 1000克",
                options: [
                    "正确",
                    "错误"
                ],
                correct: 0,
                hint: "1千克等于1000克，这是重量单位换算的基本关系。"
            },
            {
                question: "一个长方形长6厘米，宽4厘米，它的周长是多少？",
                options: [
                    "18厘米",
                    "20厘米",
                    "22厘米",
                    "24厘米"
                ],
                correct: 1,
                hint: "长方形的周长 = (长+宽)×2，所以是(6+4)×2=20厘米。"
            },
            {
                question: "36 ÷ 4 = ?",
                options: [
                    "8",
                    "9",
                    "10",
                    "11"
                ],
                correct: 1,
                hint: "36÷4=9，可以用4×9=36来验证。"
            },
            {
                question: "判断：1小时 = 60分钟",
                options: [
                    "正确",
                    "错误"
                ],
                correct: 0,
                hint: "1小时等于60分钟，这是时间单位换算的基本关系。"
            },
            {
                question: "小明有24元钱，他买了一个8元的玩具，还剩多少元？",
                options: [
                    "14元",
                    "15元",
                    "16元",
                    "17元"
                ],
                correct: 2,
                hint: "24-8=16，所以小明还剩16元。"
            },
            {
                question: "下列哪个是偶数？",
                options: [
                    "15",
                    "23",
                    "28",
                    "31"
                ],
                correct: 2,
                hint: "偶数是能被2整除的数，28÷2=14，所以28是偶数。"
            },
            {
                question: "一个圆的直径是10厘米，它的半径是多少？",
                options: [
                    "3厘米",
                    "4厘米",
                    "5厘米",
                    "6厘米"
                ],
                correct: 2,
                hint: "圆的半径是直径的一半，10÷2=5，所以半径是5厘米。"
            },
            {
                question: "45 + 28 = ?",
                options: [
                    "63",
                    "73",
                    "83",
                    "93"
                ],
                correct: 1,
                hint: "先计算个位：5+8=13，写3进1；再计算十位：4+2+1=7，所以答案是73。"
            },
            {
                question: "判断：1元 = 10角",
                options: [
                    "正确",
                    "错误"
                ],
                correct: 0,
                hint: "1元等于10角，这是人民币单位换算的基本关系。"
            },
            {
                question: "一个三角形有3个角，一个四边形有几个角？",
                options: [
                    "2个",
                    "3个",
                    "4个",
                    "5个"
                ],
                correct: 2,
                hint: "四边形的'四'表示它有4条边，每条边连接两个角，所以四边形有4个角。"
            },
            {
                question: "9 × 6 = ?",
                options: [
                    "54",
                    "56",
                    "58",
                    "60"
                ],
                correct: 0,
                hint: "9×6=54，可以用9+9+9+9+9+9=54来帮助记忆。"
            },
            {
                question: "判断：1分钟 = 60秒",
                options: [
                    "正确",
                    "错误"
                ],
                correct: 0,
                hint: "1分钟等于60秒，这是时间单位换算的基本关系。"
            },
            {
                question: "一个正方形边长是5厘米，它的面积是多少？",
                options: [
                    "20平方厘米",
                    "25平方厘米",
                    "30平方厘米",
                    "35平方厘米"
                ],
                correct: 1,
                hint: "正方形的面积 = 边长×边长，所以是5×5=25平方厘米。"
            },
            {
                question: "63 ÷ 7 = ?",
                options: [
                    "7",
                    "8",
                    "9",
                    "10"
                ],
                correct: 2,
                hint: "63÷7=9，可以用7×9=63来验证。"
            },
            {
                question: "判断：1千米 = 1000米",
                options: [
                    "正确",
                    "错误"
                ],
                correct: 0,
                hint: "1千米等于1000米，这是长度单位换算的基本关系。"
            },
            {
                question: "小明有18个气球，他给了小红5个，又给了小华3个，还剩几个？",
                options: [
                    "8个",
                    "9个",
                    "10个",
                    "11个"
                ],
                correct: 2,
                hint: "18-5-3=10，所以小明还剩10个气球。"
            },
            {
                question: "下列哪个图形是长方形？",
                options: [
                    "四条边都相等的四边形",
                    "对边相等，四个角都是直角的四边形",
                    "三条边相等的三角形",
                    "四个角都是直角的四边形"
                ],
                correct: 1,
                hint: "长方形的特点是对边相等，四个角都是直角。"
            },
            {
                question: "7 × 8 = ?",
                options: [
                    "54",
                    "56",
                    "58",
                    "60"
                ],
                correct: 1,
                hint: "7×8=56，可以用7+7+7+7+7+7+7+7=56来帮助记忆。"
            },
            {
                question: "判断：1吨 = 1000千克",
                options: [
                    "正确",
                    "错误"
                ],
                correct: 0,
                hint: "1吨等于1000千克，这是重量单位换算的基本关系。"
            },
            {
                question: "一个长方形长8厘米，宽5厘米，它的面积是多少？",
                options: [
                    "35平方厘米",
                    "40平方厘米",
                    "45平方厘米",
                    "50平方厘米"
                ],
                correct: 1,
                hint: "长方形的面积 = 长×宽，所以是8×5=40平方厘米。"
            },
            {
                question: "72 ÷ 8 = ?",
                options: [
                    "7",
                    "8",
                    "9",
                    "10"
                ],
                correct: 2,
                hint: "72÷8=9，可以用8×9=72来验证。"
            },
            {
                question: "判断：1日 = 24小时",
                options: [
                    "正确",
                    "错误"
                ],
                correct: 0,
                hint: "1日等于24小时，这是时间单位换算的基本关系。"
            },
            {
                question: "小明有32元钱，他买了一个12元的玩具，还剩多少元？",
                options: [
                    "18元",
                    "19元",
                    "20元",
                    "21元"
                ],
                correct: 2,
                hint: "32-12=20，所以小明还剩20元。"
            },
            {
                question: "下列哪个是奇数？",
                options: [
                    "24",
                    "36",
                    "42",
                    "51"
                ],
                correct: 3,
                hint: "奇数是不能被2整除的数，51÷2=25余1，所以51是奇数。"
            },
            {
                question: "一个圆的半径是6厘米，它的直径是多少？",
                options: [
                    "10厘米",
                    "12厘米",
                    "14厘米",
                    "16厘米"
                ],
                correct: 1,
                hint: "圆的直径是半径的2倍，6×2=12，所以直径是12厘米。"
            },
            {
                question: "56 + 39 = ?",
                options: [
                    "85",
                    "95",
                    "105",
                    "115"
                ],
                correct: 1,
                hint: "先计算个位：6+9=15，写5进1；再计算十位：5+3+1=9，所以答案是95。"
            },
            {
                question: "判断：1角 = 10分",
                options: [
                    "正确",
                    "错误"
                ],
                correct: 0,
                hint: "1角等于10分，这是人民币单位换算的基本关系。"
            },
            {
                question: "一个五边形有几个角？",
                options: [
                    "3个",
                    "4个",
                    "5个",
                    "6个"
                ],
                correct: 2,
                hint: "五边形的'五'表示它有5条边，每条边连接两个角，所以五边形有5个角。"
            },
            {
                question: "6 × 9 = ?",
                options: [
                    "54",
                    "56",
                    "58",
                    "60"
                ],
                correct: 0,
                hint: "6×9=54，可以用6+6+6+6+6+6+6+6+6=54来帮助记忆。"
            },
            {
                question: "判断：1星期 = 7天",
                options: [
                    "正确",
                    "错误"
                ],
                correct: 0,
                hint: "1星期等于7天，这是时间单位换算的基本关系。"
            },
            {
                question: "一个正方形边长是7厘米，它的周长是多少？",
                options: [
                    "24厘米",
                    "26厘米",
                    "28厘米",
                    "30厘米"
                ],
                correct: 2,
                hint: "正方形的周长 = 边长×4，所以是7×4=28厘米。"
            },
            {
                question: "81 ÷ 9 = ?",
                options: [
                    "7",
                    "8",
                    "9",
                    "10"
                ],
                correct: 2,
                hint: "81÷9=9，可以用9×9=81来验证。"
            },
            {
                question: "判断：1年 = 365天",
                options: [
                    "正确",
                    "错误"
                ],
                correct: 0,
                hint: "1年等于365天（平年），这是时间单位换算的基本关系。"
            },
            {
                question: "小明有15个糖果，他给了小红4个，又给了小华3个，还剩几个？",
                options: [
                    "6个",
                    "7个",
                    "8个",
                    "9个"
                ],
                correct: 2,
                hint: "15-4-3=8，所以小明还剩8个糖果。"
            },
            {
                question: "下列哪个图形是三角形？",
                options: [
                    "三条边都相等的四边形",
                    "三条边都相等的三角形",
                    "四条边都相等的四边形",
                    "四个角都是直角的四边形"
                ],
                correct: 1,
                hint: "三角形的特点是有三条边，三条边都相等的三角形是等边三角形。"
            },
            {
                question: "4 × 8 = ?",
                options: [
                    "28",
                    "30",
                    "32",
                    "34"
                ],
                correct: 2,
                hint: "4×8=32，可以用4+4+4+4+4+4+4+4=32来帮助记忆。"
            },
            {
                question: "判断：1米 = 100厘米",
                options: [
                    "正确",
                    "错误"
                ],
                correct: 0,
                hint: "1米等于100厘米，这是长度单位换算的基本关系。"
            },
            {
                question: "一个长方形长10厘米，宽6厘米，它的周长是多少？",
                options: [
                    "28厘米",
                    "30厘米",
                    "32厘米",
                    "34厘米"
                ],
                correct: 2,
                hint: "长方形的周长 = (长+宽)×2，所以是(10+6)×2=32厘米。"
            },
            {
                question: "64 ÷ 8 = ?",
                options: [
                    "6",
                    "7",
                    "8",
                    "9"
                ],
                correct: 2,
                hint: "64÷8=8，可以用8×8=64来验证。"
            },
            {
                question: "判断：1千克 = 1000克",
                options: [
                    "正确",
                    "错误"
                ],
                correct: 0,
                hint: "1千克等于1000克，这是重量单位换算的基本关系。"
            },
            {
                question: "小明有40元钱，他买了一个15元的玩具，还剩多少元？",
                options: [
                    "23元",
                    "24元",
                    "25元",
                    "26元"
                ],
                correct: 2,
                hint: "40-15=25，所以小明还剩25元。"
            }
        ];
        
        // 游戏状态
        let currentQuestion = 0;
        let score = 0;
        let coins = 100;
        let answered = false;
        let level = 1;
        let xp = 0;
        let xpToNextLevel = 100;
        let streak = 0;
        let timerInterval;
        let timeLeft = 30;
        let doubleXpActive = false;
        let freezeTimerActive = false;
        let doubleXpCount = 1;
        let freezeTimerCount = 1;
        let removeWrongCount = 1;
        
        // 头像解锁状态
        const avatars = [
            { id: 1, src: "https://img.icons8.com/color/96/000000/math.png", unlocked: true },
            { id: 2, src: "https://img.icons8.com/color/96/000000/calculator.png", unlocked: false },
            { id: 3, src: "https://img.icons8.com/color/96/000000/geometry.png", unlocked: false },
            { id: 4, src: "https://img.icons8.com/color/96/000000/abacus.png", unlocked: false }
        ];
        
        // DOM元素
        const questionElement = document.getElementById('question');
        const optionsElement = document.getElementById('options');
        const coinsElement = document.getElementById('coins');
        const progressFill = document.getElementById('progress-fill');
        const hintBtn = document.getElementById('hint-btn');
        const skipBtn = document.getElementById('skip-btn');
        const hintModal = document.getElementById('hint-modal');
        const hintText = document.getElementById('hint-text');
        const closeHint = document.getElementById('close-hint');
        const resultModal = document.getElementById('result-modal');
        const resultIcon = document.getElementById('result-icon');
        const resultTitle = document.getElementById('result-title');
        const resultText = document.getElementById('result-text');
        const coinsEarned = document.getElementById('coins-earned');
        const xpEarned = document.getElementById('xp-earned');
        const nextQuestionBtn = document.getElementById('next-question');
        const celebrationContainer = document.getElementById('celebration-container');
        const levelElement = document.getElementById('level');
        const xpElement = document.getElementById('xp');
        const questionNumber = document.getElementById('question-number');
        const timerElement = document.getElementById('timer');
        const streakContainer = document.getElementById('streak-container');
        const streakCount = document.getElementById('streak-count');
        const avatarElement = document.getElementById('avatar');
        const levelUpModal = document.getElementById('level-up');
        const newLevelText = document.getElementById('new-level');
        const closeLevelUp = document.getElementById('close-level-up');
        const dailyRewardModal = document.getElementById('daily-reward');
        const claimRewardBtn = document.getElementById('claim-reward');
        const doubleXpBtn = document.getElementById('double-xp');
        const freezeTimerBtn = document.getElementById('freeze-timer');
        const removeWrongBtn = document.getElementById('remove-wrong');
        const doubleXpCountElement = document.getElementById('double-xp-count');
        const freezeTimerCountElement = document.getElementById('freeze-timer-count');
        const removeWrongCountElement = document.getElementById('remove-wrong-count');
        
        // 初始化游戏
        function initGame() {
            // 检查是否有每日奖励
            checkDailyReward();
            
            // 确保DOM元素已加载
            if (!questionElement || !optionsElement) {
                console.error('Required DOM elements not found');
                return;
            }
            
            loadQuestion();
            updateCoins();
            updateXp();
            updateStreak();
            updatePowerups();
            
            // 事件监听
            hintBtn.addEventListener('click', showHint);
            skipBtn.addEventListener('click', skipQuestion);
            closeHint.addEventListener('click', () => hintModal.classList.add('hidden'));
            nextQuestionBtn.addEventListener('click', nextQuestion);
            closeLevelUp.addEventListener('click', () => levelUpModal.classList.add('hidden'));
            claimRewardBtn.addEventListener('click', claimDailyReward);
            doubleXpBtn.addEventListener('click', activateDoubleXp);
            freezeTimerBtn.addEventListener('click', activateFreezeTimer);
            removeWrongBtn.addEventListener('click', activateRemoveWrong);
            
            // 点击头像可以切换
            avatarElement.addEventListener('click', showAvatarSelection);
            
            // 开始计时器
            startTimer();
        }
        
        // 检查每日奖励
        function checkDailyReward() {
            const lastPlayed = localStorage.getItem('lastPlayed');
            const today = new Date().toDateString();
            
            if (!lastPlayed || lastPlayed !== today) {
                // 显示每日奖励
                setTimeout(() => {
                    dailyRewardModal.classList.remove('hidden');
                }, 1000);
                
                // 更新连续登录天数
                const streakDays = parseInt(localStorage.getItem('streakDays')) || 0;
                const yesterday = new Date();
                yesterday.setDate(yesterday.getDate() - 1);
                
                if (lastPlayed === yesterday.toDateString()) {
                    localStorage.setItem('streakDays', streakDays + 1);
                } else if (!lastPlayed) {
                    localStorage.setItem('streakDays', 1);
                } else {
                    localStorage.setItem('streakDays', 1);
                }
                
                localStorage.setItem('lastPlayed', today);
            }
        }
        
        // 领取每日奖励
        function claimDailyReward() {
            const streakDays = parseInt(localStorage.getItem('streakDays')) || 1;
            let reward = 20;
            
            if (streakDays >= 7) reward = 200;
            else if (streakDays >= 5) reward = 100;
            else if (streakDays >= 3) reward = 50;
            
            coins += reward;
            updateCoins();
            dailyRewardModal.classList.add('hidden');
            
            // 显示奖励获得提示
            showToast(`获得每日奖励: ${reward}金币`);
        }
        
        // 显示Toast提示
        function showToast(message) {
            const toast = document.createElement('div');
            toast.className = 'fixed bottom-20 left-1/2 transform -translate-x-1/2 bg-black text-white px-4 py-2 rounded-lg z-50 animate-bounce';
            toast.textContent = message;
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.remove();
            }, 2000);
        }
        
        // 加载问题
        function loadQuestion() {
            if (currentQuestion >= questions.length) {
                console.error('No more questions available');
                return;
            }
            
            answered = false;
            timeLeft = 30;
            updateTimerDisplay();
            
            const question = questions[currentQuestion];
            if (!question) {
                console.error('Question not found at index:', currentQuestion);
                return;
            }
            
            questionElement.textContent = question.question;
            questionNumber.textContent = `问题 ${currentQuestion + 1}/${questions.length}`;
            
            optionsElement.innerHTML = '';
            question.options.forEach((option, index) => {
                const optionElement = document.createElement('div');
                optionElement.className = 'option bg-white p-4 rounded-lg text-center font-medium shadow-md hover:bg-gray-50';
                optionElement.textContent = option;
                optionElement.dataset.index = index;
                optionElement.addEventListener('click', selectOption);
                optionsElement.appendChild(optionElement);
            });
            
            // 更新进度条
            progressFill.style.width = `${(currentQuestion / questions.length) * 100}%`;
            
            // 重置计时器
            clearInterval(timerInterval);
            startTimer();
        }
        
        // 开始计时器
        function startTimer() {
            clearInterval(timerInterval);
            timeLeft = 30;
            updateTimerDisplay();
            
            timerInterval = setInterval(() => {
                if (!freezeTimerActive) {
                    timeLeft--;
                    updateTimerDisplay();
                    
                    if (timeLeft <= 0) {
                        clearInterval(timerInterval);
                        timeUp();
                    }
                }
            }, 1000);
        }
        
        // 更新时间显示
        function updateTimerDisplay() {
            let displayTime = timeLeft;
            let emoji = "⏱️";
            
            if (timeLeft <= 10) {
                emoji = "🔥";
                timerElement.className = "text-sm font-bold text-red-500";
            } else if (timeLeft <= 20) {
                emoji = "⌛";
                timerElement.className = "text-sm font-bold text-yellow-500";
            } else {
                timerElement.className = "text-sm font-bold";
            }
            
            timerElement.textContent = `${emoji} ${displayTime}秒`;
        }
        
        // 时间到
        function timeUp() {
            if (answered) return;
            answered = true;
            
            const correctIndex = questions[currentQuestion].correct;
            const options = document.querySelectorAll('.option');
            
            // 标记正确的选项
            options.forEach((option, index) => {
                if (index === correctIndex) {
                    option.classList.add('correct');
                }
                
                // 禁用所有选项
                option.style.pointerEvents = 'none';
            });
            
            // 显示结果
            resultIcon.className = 'fas fa-hourglass-end text-5xl mb-4 text-red-500';
            resultTitle.textContent = '时间到!';
            resultText.textContent = `正确答案: ${questions[currentQuestion].options[correctIndex]}`;
            coinsEarned.textContent = '0';
            xpEarned.textContent = '5';
            resultModal.classList.remove('hidden');
            
            // 减少连续登录天数
            streak = 0;
            updateStreak();
            
            // 给予少量经验
            addXp(5);
        }
        
        // 选择选项
        function selectOption(e) {
            if (answered) return;
            answered = true;
            clearInterval(timerInterval);
            
            const selectedIndex = parseInt(e.target.dataset.index);
            const correctIndex = questions[currentQuestion].correct;
            const options = document.querySelectorAll('.option');
            
            // 标记正确和错误的选项
            options.forEach((option, index) => {
                if (index === correctIndex) {
                    option.classList.add('correct');
                } else if (index === selectedIndex && index !== correctIndex) {
                    option.classList.add('wrong');
                }
                
                // 禁用所有选项
                option.style.pointerEvents = 'none';
            });
            
            // 检查答案
            if (selectedIndex === correctIndex) {
                score++;
                
                // 计算奖励
                let coinsReward = 20 + Math.floor(timeLeft / 5);
                let xpReward = 10 + Math.floor(timeLeft / 3);
                
                // 双倍经验
                if (doubleXpActive) {
                    xpReward *= 2;
                    doubleXpActive = false;
                }
                
                coins += coinsReward;
                addXp(xpReward);
                
                // 更新连续登录天数
                streak++;
                updateStreak();
                
                // 显示结果
                coinsEarned.textContent = coinsReward;
                xpEarned.textContent = xpReward;
                showResult(true);
            } else {
                coins = Math.max(0, coins - 10);
                addXp(5);
                
                // 减少连续登录天数
                streak = 0;
                updateStreak();
                
                // 显示结果
                coinsEarned.textContent = '-10';
                xpEarned.textContent = '5';
                showResult(false);
            }
            
            updateCoins();
        }
        
        // 显示结果
        function showResult(isCorrect) {
            if (isCorrect) {
                resultIcon.className = 'fas fa-check-circle text-5xl mb-4 text-green-500';
                resultTitle.textContent = '回答正确!';
                resultText.textContent = '你太棒了!';
                
                // 庆祝动画
                if (score % 3 === 0) {
                    showCelebration();
                }
            } else {
                resultIcon.className = 'fas fa-times-circle text-5xl mb-4 text-red-500';
                resultTitle.textContent = '回答错误!';
                resultText.textContent = `正确答案: ${questions[currentQuestion].options[questions[currentQuestion].correct]}`;
            }
            
            resultModal.classList.remove('hidden');
        }
        
        // 显示庆祝动画
        function showCelebration() {
            celebrationContainer.classList.remove('hidden');
            celebrationContainer.innerHTML = '';
            
            // 创建50个彩色纸屑
            for (let i = 0; i < 50; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.left = Math.random() * 100 + 'vw';
                confetti.style.backgroundColor = `hsl(${Math.random() * 360}, 100%, 50%)`;
                confetti.style.animationDuration = 3 + Math.random() * 3 + 's';
                confetti.style.animationDelay = Math.random() * 2 + 's';
                celebrationContainer.appendChild(confetti);
            }
            
            setTimeout(() => {
                celebrationContainer.classList.add('hidden');
            }, 3000);
        }
        
        // 下一题
        function nextQuestion() {
            resultModal.classList.add('hidden');
            currentQuestion++;
            
            if (currentQuestion < questions.length) {
                loadQuestion();
            } else {
                // 游戏结束
                questionElement.textContent = `游戏结束! 你的得分是 ${score}/${questions.length}`;
                optionsElement.innerHTML = '';
                hintBtn.style.display = 'none';
                skipBtn.style.display = 'none';
                clearInterval(timerInterval);
                
                // 显示最终得分和奖励
                const finalCoins = score * 20;
                const finalXp = score * 15;
                coins += finalCoins;
                addXp(finalXp);
                
                // 显示庆祝动画
                showCelebration();
                
                // 添加重新开始按钮
                const restartBtn = document.createElement('button');
                restartBtn.className = 'bg-blue-600 text-white px-6 py-2 rounded-full mt-4';
                restartBtn.textContent = '再来一次';
                restartBtn.addEventListener('click', restartGame);
                optionsElement.appendChild(restartBtn);
                
                // 根据得分给予道具奖励
                if (score >= 8) {
                    doubleXpCount += 2;
                    freezeTimerCount += 1;
                    removeWrongCount += 1;
                    updatePowerups();
                    showToast("完美表现! 获得额外道具奖励!");
                } else if (score >= 5) {
                    doubleXpCount += 1;
                    updatePowerups();
                    showToast("不错的表现! 获得额外道具奖励!");
                }
            }
        }
        
        // 重新开始游戏
        function restartGame() {
            currentQuestion = 0;
            score = 0;
            hintBtn.style.display = 'block';
            skipBtn.style.display = 'block';
            loadQuestion();
        }
        
        // 显示提示
        function showHint() {
            if (coins < 20) {
                showToast('金币不足!');
                return;
            }
            
            coins -= 20;
            updateCoins();
            hintText.textContent = questions[currentQuestion].hint;
            hintModal.classList.remove('hidden');
        }
        
        // 跳过问题
        function skipQuestion() {
            if (coins < 30) {
                showToast('金币不足!');
                return;
            }
            
            coins -= 30;
            updateCoins();
            currentQuestion++;
            
            if (currentQuestion < questions.length) {
                loadQuestion();
            } else {
                nextQuestion();
            }
        }
        
        // 更新金币显示
        function updateCoins() {
            coinsElement.textContent = coins;
        }
        
        // 更新经验值
        function updateXp() {
            levelElement.textContent = `等级: ${level}`;
            xpElement.textContent = `经验: ${xp}/${xpToNextLevel}`;
            
            // 更新经验条
            const xpPercentage = (xp / xpToNextLevel) * 100;
            progressFill.style.width = `${xpPercentage}%`;
        }
        
        // 增加经验值
        function addXp(amount) {
            xp += amount;
            
            // 检查是否升级
            if (xp >= xpToNextLevel) {
                level++;
                xp -= xpToNextLevel;
                xpToNextLevel = Math.floor(xpToNextLevel * 1.5);
                
                // 显示升级提示
                newLevelText.textContent = `你现在是等级 ${level}!`;
                levelUpModal.classList.remove('hidden');
                
                // 解锁新头像
                if (level >= 3 && !avatars[1].unlocked) {
                    avatars[1].unlocked = true;
                    showToast("解锁新头像: 计算器!");
                } else if (level >= 5 && !avatars[2].unlocked) {
                    avatars[2].unlocked = true;
                    showToast("解锁新头像: 几何图形!");
                } else if (level >= 7 && !avatars[3].unlocked) {
                    avatars[3].unlocked = true;
                    showToast("解锁新头像: 算盘!");
                }
                
                // 升级奖励
                coins += level * 50;
                updateCoins();
            }
            
            updateXp();
        }
        
        // 更新连续登录天数显示
        function updateStreak() {
            if (streak > 0) {
                streakContainer.style.display = 'flex';
                streakCount.textContent = streak;
            } else {
                streakContainer.style.display = 'none';
            }
        }
        
        // 显示头像选择
        function showAvatarSelection() {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            
            const content = document.createElement('div');
            content.className = 'bg-white p-6 rounded-lg max-w-sm w-full mx-4';
            
            const title = document.createElement('h3');
            title.className = 'text-xl font-bold mb-4 text-blue-600';
            title.textContent = '选择头像';
            content.appendChild(title);
            
            const avatarContainer = document.createElement('div');
            avatarContainer.className = 'flex justify-around flex-wrap';
            
            avatars.forEach(avatar => {
                const avatarDiv = document.createElement('div');
                avatarDiv.className = 'text-center mb-4';
                
                const img = document.createElement('img');
                img.src = avatar.src;
                img.className = 'avatar mb-2 cursor-pointer';
                if (!avatar.unlocked) {
                    img.style.filter = 'grayscale(100%)';
                    img.style.opacity = '0.5';
                }
                
                img.addEventListener('click', () => {
                    if (avatar.unlocked) {
                        avatarElement.src = avatar.src;
                        modal.remove();
                        showToast(`已切换到头像 ${avatar.id}`);
                    } else {
                        showToast(`等级 ${avatar.id * 2 + 1} 解锁`);
                    }
                });
                
                avatarDiv.appendChild(img);
                
                if (!avatar.unlocked) {
                    const lock = document.createElement('div');
                    lock.className = 'text-sm text-gray-500';
                    lock.textContent = '等级 ' + (avatar.id * 2 + 1);
                    avatarDiv.appendChild(lock);
                }
                
                avatarContainer.appendChild(avatarDiv);
            });
            
            content.appendChild(avatarContainer);
            
            const closeBtn = document.createElement('button');
            closeBtn.className = 'bg-gray-200 text-gray-800 px-4 py-2 rounded mt-4';
            closeBtn.textContent = '关闭';
            closeBtn.addEventListener('click', () => modal.remove());
            content.appendChild(closeBtn);
            
            modal.appendChild(content);
            document.body.appendChild(modal);
        }
        
        // 更新道具数量显示
        function updatePowerups() {
            doubleXpCountElement.textContent = doubleXpCount;
            freezeTimerCountElement.textContent = freezeTimerCount;
            removeWrongCountElement.textContent = removeWrongCount;
        }
        
        // 激活双倍经验
        function activateDoubleXp() {
            if (doubleXpCount <= 0) {
                showToast('道具不足!');
                return;
            }
            
            doubleXpCount--;
            doubleXpActive = true;
            updatePowerups();
            
            showToast('双倍经验已激活!');
            
            // 30秒后失效
            setTimeout(() => {
                if (doubleXpActive) {
                    doubleXpActive = false;
                    showToast('双倍经验已结束');
                }
            }, 30000);
        }
        
        // 激活冻结时间
        function activateFreezeTimer() {
            if (freezeTimerCount <= 0) {
                showToast('道具不足!');
                return;
            }
            
            freezeTimerCount--;
            freezeTimerActive = true;
            updatePowerups();
            
            showToast('时间冻结10秒!');
            
            // 10秒后解冻
            setTimeout(() => {
                freezeTimerActive = false;
                showToast('时间恢复流动');
            }, 10000);
        }
        
        // 激活移除错误答案
        function activateRemoveWrong() {
            if (removeWrongCount <= 0) {
                showToast('道具不足!');
                return;
            }
            
            if (answered) {
                showToast('问题已回答，无法使用');
                return;
            }
            
            removeWrongCount--;
            updatePowerups();
            
            const correctIndex = questions[currentQuestion].correct;
            const options = document.querySelectorAll('.option');
            let removed = 0;
            
            options.forEach((option, index) => {
                if (index !== correctIndex && removed < 2) {
                    if (!option.classList.contains('wrong')) {
                        option.style.visibility = 'hidden';
                        option.style.pointerEvents = 'none';
                        removed++;
                    }
                }
            });
            
            showToast('已移除2个错误答案!');
        }
        
        // 初始化游戏
        window.onload = initGame;
    </script>
</body>
</html> 